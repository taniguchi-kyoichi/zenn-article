---
title: "[Swift]æ¯é€±æŒ‡å®šã®æ™‚é–“ã«é€šçŸ¥ã™ã‚‹"
emoji: "ğŸ“±"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [swift, ios]
published: true
---

ã“ã®è¨˜äº‹ã§ã¯ã€Swiftã§é–‹ç™ºã•ã‚ŒãŸã‚¢ãƒ—ãƒªã€Œã”ã»ã†ã³ç¿’æ…£ãƒ—ãƒ©ã‚¹ã€ã®æ ¸ã¨ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸€ã¤ã§ã‚ã‚‹é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒªã¯ã€ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨ã—ãŸç¿’æ…£åŒ–ã‚¢ãƒ—ãƒªã§ã€æ—¥ã€…ã®ç¿’æ…£ã‚’æ¥½ã—ãç¶­æŒã™ã‚‹ãŸã‚ã®æ”¯æ´ã‚’ã—ã¦ã„ã¾ã™ã€‚

https://apps.apple.com/jp/app/%E3%81%94%E3%81%BB%E3%81%86%E3%81%B3%E7%BF%92%E6%85%A3%E3%83%97%E3%83%A9%E3%82%B9-%E3%82%B2%E3%83%BC%E3%83%9F%E3%83%95%E3%82%A3%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%BF%92%E6%85%A3%E5%8C%96%E3%82%A2%E3%83%97%E3%83%AA/id6474091359

ã€Œã”ã»ã†ã³ç¿’æ…£ãƒ—ãƒ©ã‚¹ã€ã«ãŠã‘ã‚‹é€šçŸ¥æ©Ÿèƒ½ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¿’æ…£åŒ–ã‚¿ã‚¹ã‚¯ã®å®Ÿæ–½ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã«æ¯é€±ç‰¹å®šã®æ™‚é–“ã«é€šçŸ¥ã‚’å—ã‘å–ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ã€ç¿’æ…£åŒ–ã‚’ä¿ƒé€²ã™ã‚‹ä¸Šã§æ¥µã‚ã¦é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¦ãŠã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®šæœŸçš„ã«ã‚¿ã‚¹ã‚¯ã‚’è¡Œã†ãŸã‚ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

## ç¿’æ…£åŒ–æ”¯æ´ã®é‡è¦æ€§

ç¿’æ…£åŒ–ã¯ã€æ–°ã—ã„è¡Œå‹•ã‚’å®šç€ã•ã›ã‚‹ãŸã‚ã«åŠ¹æœçš„ãªæ–¹æ³•ã§ã™ã€‚ã—ã‹ã—ã€æ—¥ã€…ã®å¿™ã—ã•ã®ä¸­ã§æ–°ã—ã„ç¿’æ…£ã‚’æ€ã„å‡ºã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯é›£ã—ã„ã“ã¨ãŒå¤šã„ã§ã™ã€‚ã“ã“ã§ã€Œã”ã»ã†ã³ç¿’æ…£ãƒ—ãƒ©ã‚¹ã€ã®é€šçŸ¥æ©Ÿèƒ½ãŒé‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

## é€šçŸ¥æ©Ÿèƒ½ã®å½¹å‰²

- ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¨ã—ã¦ã®å½¹å‰²: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã—ãŸç‰¹å®šã®æ›œæ—¥ã¨æ™‚é–“ã«é€šçŸ¥ãŒé€ã‚‰ã‚Œã‚‹ã“ã¨ã§ã€ç¿’æ…£åŒ–ã‚¿ã‚¹ã‚¯ã®å®Ÿæ–½ã‚’å¿˜ã‚Œãšã«ã™ã‚€ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- ç¶™ç¶šçš„ãªã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ: å®šæœŸçš„ãªé€šçŸ¥ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

# å®Ÿè£…æ–¹æ³•

å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚é€šçŸ¥æ©Ÿèƒ½å…¨ä½“ã‚’ä¸€ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚

``` swift
import Foundation
import UserNotifications

struct NotificationService {
    static func setRepeatCalenderNotification(id: String, weekday: Weekday, title: String, body: String, hour: Int, minute: Int, completion: @escaping (_ error: Error?) -> Void) {
        let content = UNMutableNotificationContent()
        content.title = title
        content.body = body
        content.sound = UNNotificationSound.default

        var dateComponents = DateComponents()
        dateComponents.weekday = weekday.rawValue
        dateComponents.hour = hour
        dateComponents.minute = minute

        let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents, repeats: true)

        let request = UNNotificationRequest(identifier: "\(id)/\(weekday.name)", content: content, trigger: trigger)

        UNUserNotificationCenter.current().add(request) { error in
            completion(error)
        }
    }
    
    static func cancelRepeatNotification(id: String, weekday: Weekday) {
        UNUserNotificationCenter.current().removePendingNotificationRequests(withIdentifiers: ["\(id)/\(weekday.name)"])
    }
    
    static func checkNotificationAuthorization(completion: @escaping (_ isAuthorized: Bool) -> Void) {
        UNUserNotificationCenter.current().getNotificationSettings { settings in
            if settings.authorizationStatus == .authorized {
                completion(true)
            } else {
                completion(false)
            }
        }
    }
}

enum Weekday: Int {
    case sunday = 1, monday, tuesday, wednesday, thursday, friday, saturday
    
    var name: String {
        switch self {
        case .sunday:
            return "Sunday"
        case .monday:
            return "Monday"
        case .tuesday:
            return "Tuesday"
        case .wednesday:
            return "Wednesday"
        case .thursday:
            return "Thursday"
        case .friday:
            return "Friday"
        case .saturday:
            return "Saturday"
        }
    }

    var title: String {
        switch self {
        case .sunday:
            return "æ—¥æ›œæ—¥"
        case .monday:
            return "æœˆæ›œæ—¥"
        case .tuesday:
            return "ç«æ›œæ—¥"
        case .wednesday:
            return "æ°´æ›œæ—¥"
        case .thursday:
            return "æœ¨æ›œæ—¥"
        case .friday:
            return "é‡‘æ›œæ—¥"
        case .saturday:
            return "åœŸæ›œæ—¥"
        }
    }
}
```

## setRepeatCalenderNotification ãƒ¡ã‚½ãƒƒãƒ‰

- é€šçŸ¥å†…å®¹ã®è¨­å®š:

UNMutableNotificationContent ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€é€šçŸ¥ã®ã‚¿ã‚¤ãƒˆãƒ«ã€æœ¬æ–‡ã€ã‚µã‚¦ãƒ³ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚

- é€šçŸ¥ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®š:

DateComponents ã‚’ä½¿ç”¨ã—ã¦ã€é€šçŸ¥ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹æ›œæ—¥ã€æ™‚é–“ï¼ˆæ™‚ã¨åˆ†ï¼‰ã‚’è¨­å®šã—ã¾ã™ã€‚

UNCalendarNotificationTrigger ã‚’ä½¿ã£ã¦ã€ã“ã‚Œã‚‰ã® DateComponents ã«åŸºã¥ã„ã¦é€šçŸ¥ãƒˆãƒªã‚¬ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚repeats ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ true ã«è¨­å®šã•ã‚Œã€ã“ã‚Œã«ã‚ˆã‚Šé€šçŸ¥ã¯æ¯é€±ç¹°ã‚Šè¿”ã•ã‚Œã¾ã™ã€‚

## cancelRepeatNotification ãƒ¡ã‚½ãƒƒãƒ‰

ç‰¹å®šã®IDã¨æ›œæ—¥ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸé€šçŸ¥ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã€‚

## checkNotificationAuthorization ãƒ¡ã‚½ãƒƒãƒ‰

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¢ãƒ—ãƒªãŒé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€šçŸ¥ã‚’è¨±å¯ã—ã¦ã„ãªã„å ´åˆã€ã‚¢ãƒ—ãƒªã¯é€šçŸ¥ã‚’é€ä¿¡ã§ãã¾ã›ã‚“ã€‚

## Weekdayã®å®Ÿè£…

Weekday åˆ—æŒ™å‹ã¯ã€æ›œæ—¥ã‚’è¡¨ã—ã¾ã™ã€‚å„æ›œæ—¥ã¯æ•´æ•°ã¨æ–‡å­—åˆ—ã®ä¸¡æ–¹ã®å€¤ã‚’æŒãŸã›ã¾ã™ã€‚ã“ã®æ•´æ•°ã¯DateComponentsã®æ›œæ—¥ã‚’è¡¨ã™idã¨å¯¾å¿œã•ã›ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚

ã“ã“ã¾ã§ãŠèª­ã¿ã„ãŸã ã„ã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é †ç•ªã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã§æ¯æ—¥æŒ‡å®šæ™‚é–“ã«é€šçŸ¥ã™ã‚‹ã¨ã„ã£ãŸå®Ÿè£…ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚æœ€å¾Œã«ã”ã»ã†ã³ç¿’æ…£ãƒ—ãƒ©ã‚¹ã‚’ãœã²ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ï¼

https://apps.apple.com/jp/app/%E3%81%94%E3%81%BB%E3%81%86%E3%81%B3%E7%BF%92%E6%85%A3%E3%83%97%E3%83%A9%E3%82%B9-%E3%82%B2%E3%83%BC%E3%83%9F%E3%83%95%E3%82%A3%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%BF%92%E6%85%A3%E5%8C%96%E3%82%A2%E3%83%97%E3%83%AA/id6474091359